name: Conversion et Copie

on:
  push:
    branches:
      - main

jobs:
  convert_and_copy:
    runs-on: ubuntu-latest

    steps:

    - name: Générer la Version
      run: echo "1.0" > $GITHUB_WORKSPACE/version.txt  # Remplacez "1.0" par la version de votre projet

    - name: Checkout du code
      uses: actions/checkout@v2

    - name: Installer Pandoc
      run: sudo apt-get install pandoc

    - name: Installer pdflatex
      run: sudo apt-get install texlive-xetex

    - name: Conversion en PDF
      run: |
        mkdir -p kit_pedagogique  # Créez le dossier de destination s'il n'existe pas

        for file in content/*.md; do
          # Récupérez le nom du fichier sans l'extension .md
          filename=$(basename "$file" .md)
          
          # Convertissez le fichier Markdown en PDF
          pandoc "$file" -o "kit_pedagogique/${filename}.pdf" 

        done


    - name: Copier le Code Eleve
      run: |
        mkdir -p kit_pedagogique/code  # Créez le dossier de destination s'il n'existe pas
        mkdir -p kit_pedagogique/ressources  # Créez le dossier de destination s'il n'existe pas
        
        # Copiez l'intégralité du dossier eleve dans le dossier code du kit pédagogique
        cp -r code/student/* kit_pedagogique/code/
        cp -r ressources/student/* kit_pedagogique/ressources/


    - name: Deploy on gh-pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        publish_dir: ./kit_pedagogique
        force_orphan: true